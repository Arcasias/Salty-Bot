import Command from "../../classes/Command";
import { EmptyObject, MissingArg, SaltyException, } from "../../classes/Exception";
import QuickCommand from "../../classes/QuickCommand";
import Salty from "../../classes/Salty";
export default new Command({
    name: "command",
    keys: ["cmd", "commands"],
    help: [
        {
            argument: null,
            effect: null,
        },
        {
            argument: "***command key 1***, ***command key 2***, ...  \\`\\`\\`***command block***\\`\\`\\`",
            effect: "Creates a new command having ***command keys*** as its triggers. ***command effect*** will then be displayed as a response",
        },
    ],
    visibility: "dev",
    async action(msg, args) {
        switch (this.meaning(args[0])) {
            case "delete":
                const commandName = args[1];
                if (!commandName) {
                    throw new MissingArg("command");
                }
                const command = QuickCommand.find((cmd) => cmd.keys.includes(commandName));
                if (!command) {
                    throw new SaltyException("NonExistingObject", "That command doesn't exist");
                }
                Salty.unsetQuickCommand(command);
                await QuickCommand.remove(command.id);
                Salty.success(msg, `Command "**${command.name}**" deleted`);
                break;
            case "list":
            case "noarg":
                if (!QuickCommand.size) {
                    throw new EmptyObject("commands");
                }
                await Salty.embed(msg, {
                    title: "List of commands",
                    description: QuickCommand.map((cmd, i) => `${i + 1}) ${cmd.name}`).join("\n"),
                });
                break;
            default:
                const allArgs = args.join(" ").split("```");
                if (!allArgs[1]) {
                    throw new MissingArg("effect");
                }
                let keys = allArgs
                    .shift()
                    .split(",")
                    .filter((word) => word.trim() !== "");
                const name = keys[0];
                const effect = allArgs.shift().trim();
                if (!keys[0]) {
                    throw new MissingArg("keys");
                }
                for (let key = 0; key < keys.length; key++) {
                    keys[key] = keys[key].trim().toLowerCase();
                    if (Salty.commands.keys[keys[key]]) {
                        throw new SaltyException("ExistingObject", "That command already exists");
                    }
                }
                const commands = await QuickCommand.create({
                    name,
                    keys: keys.join(),
                    effect,
                });
                Salty.setQuickCommand(commands[0]);
                await Salty.success(msg, `Command "**${name}**" created`);
        }
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tbWFuZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb21tYW5kcy9jb25maWcvY29tbWFuZC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLE9BQU8sTUFBTSx1QkFBdUIsQ0FBQztBQUM1QyxPQUFPLEVBQ0gsV0FBVyxFQUNYLFVBQVUsRUFDVixjQUFjLEdBQ2pCLE1BQU0seUJBQXlCLENBQUM7QUFDakMsT0FBTyxZQUFZLE1BQU0sNEJBQTRCLENBQUM7QUFDdEQsT0FBTyxLQUFLLE1BQU0scUJBQXFCLENBQUM7QUFFeEMsZUFBZSxJQUFJLE9BQU8sQ0FBQztJQUN2QixJQUFJLEVBQUUsU0FBUztJQUNmLElBQUksRUFBRSxDQUFDLEtBQUssRUFBRSxVQUFVLENBQUM7SUFDekIsSUFBSSxFQUFFO1FBQ0Y7WUFDSSxRQUFRLEVBQUUsSUFBSTtZQUNkLE1BQU0sRUFBRSxJQUFJO1NBQ2Y7UUFDRDtZQUNJLFFBQVEsRUFDSixzRkFBc0Y7WUFDMUYsTUFBTSxFQUNGLDRIQUE0SDtTQUNuSTtLQUNKO0lBQ0QsVUFBVSxFQUFFLEtBQUs7SUFDakIsS0FBSyxDQUFDLE1BQU0sQ0FBQyxHQUFHLEVBQUUsSUFBSTtRQUNsQixRQUFRLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUU7WUFDM0IsS0FBSyxRQUFRO2dCQUNULE1BQU0sV0FBVyxHQUFXLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDcEMsSUFBSSxDQUFDLFdBQVcsRUFBRTtvQkFDZCxNQUFNLElBQUksVUFBVSxDQUFDLFNBQVMsQ0FBQyxDQUFDO2lCQUNuQztnQkFDRCxNQUFNLE9BQU8sR0FBaUIsWUFBWSxDQUFDLElBQUksQ0FDM0MsQ0FBQyxHQUFpQixFQUFXLEVBQUUsQ0FDM0IsR0FBRyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLENBQ3JDLENBQUM7Z0JBQ0YsSUFBSSxDQUFDLE9BQU8sRUFBRTtvQkFDVixNQUFNLElBQUksY0FBYyxDQUNwQixtQkFBbUIsRUFDbkIsNEJBQTRCLENBQy9CLENBQUM7aUJBQ0w7Z0JBQ0QsS0FBSyxDQUFDLGlCQUFpQixDQUFDLE9BQU8sQ0FBQyxDQUFDO2dCQUNqQyxNQUFNLFlBQVksQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxDQUFDO2dCQUV0QyxLQUFLLENBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxjQUFjLE9BQU8sQ0FBQyxJQUFJLGFBQWEsQ0FBQyxDQUFDO2dCQUM1RCxNQUFNO1lBQ1YsS0FBSyxNQUFNLENBQUM7WUFDWixLQUFLLE9BQU87Z0JBQ1IsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLEVBQUU7b0JBQ3BCLE1BQU0sSUFBSSxXQUFXLENBQUMsVUFBVSxDQUFDLENBQUM7aUJBQ3JDO2dCQUNELE1BQU0sS0FBSyxDQUFDLEtBQUssQ0FBQyxHQUFHLEVBQUU7b0JBQ25CLEtBQUssRUFBRSxrQkFBa0I7b0JBQ3pCLFdBQVcsRUFBRSxZQUFZLENBQUMsR0FBRyxDQUN6QixDQUFDLEdBQUcsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsS0FBSyxHQUFHLENBQUMsSUFBSSxFQUFFLENBQ3RDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQztpQkFDZixDQUFDLENBQUM7Z0JBQ0gsTUFBTTtZQUNWO2dCQUNJLE1BQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDO2dCQUU1QyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxFQUFFO29CQUNiLE1BQU0sSUFBSSxVQUFVLENBQUMsUUFBUSxDQUFDLENBQUM7aUJBQ2xDO2dCQUNELElBQUksSUFBSSxHQUFhLE9BQU87cUJBQ3ZCLEtBQUssRUFBRTtxQkFDUCxLQUFLLENBQUMsR0FBRyxDQUFDO3FCQUNWLE1BQU0sQ0FBQyxDQUFDLElBQUksRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDO2dCQUMxQyxNQUFNLElBQUksR0FBVyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQzdCLE1BQU0sTUFBTSxHQUFXLE9BQU8sQ0FBQyxLQUFLLEVBQUUsQ0FBQyxJQUFJLEVBQUUsQ0FBQztnQkFFOUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRTtvQkFDVixNQUFNLElBQUksVUFBVSxDQUFDLE1BQU0sQ0FBQyxDQUFDO2lCQUNoQztnQkFFRCxLQUFLLElBQUksR0FBRyxHQUFHLENBQUMsRUFBRSxHQUFHLEdBQUcsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLEVBQUUsRUFBRTtvQkFDeEMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxXQUFXLEVBQUUsQ0FBQztvQkFFM0MsSUFBSSxLQUFLLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRTt3QkFDaEMsTUFBTSxJQUFJLGNBQWMsQ0FDcEIsZ0JBQWdCLEVBQ2hCLDZCQUE2QixDQUNoQyxDQUFDO3FCQUNMO2lCQUNKO2dCQUVELE1BQU0sUUFBUSxHQUFtQixNQUFNLFlBQVksQ0FBQyxNQUFNLENBQUM7b0JBQ3ZELElBQUk7b0JBQ0osSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJLEVBQUU7b0JBQ2pCLE1BQU07aUJBQ1QsQ0FBQyxDQUFDO2dCQUNILEtBQUssQ0FBQyxlQUFlLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBRW5DLE1BQU0sS0FBSyxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsY0FBYyxJQUFJLGFBQWEsQ0FBQyxDQUFDO1NBQ2pFO0lBQ0wsQ0FBQztDQUNKLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBDb21tYW5kIGZyb20gXCIuLi8uLi9jbGFzc2VzL0NvbW1hbmRcIjtcbmltcG9ydCB7XG4gICAgRW1wdHlPYmplY3QsXG4gICAgTWlzc2luZ0FyZyxcbiAgICBTYWx0eUV4Y2VwdGlvbixcbn0gZnJvbSBcIi4uLy4uL2NsYXNzZXMvRXhjZXB0aW9uXCI7XG5pbXBvcnQgUXVpY2tDb21tYW5kIGZyb20gXCIuLi8uLi9jbGFzc2VzL1F1aWNrQ29tbWFuZFwiO1xuaW1wb3J0IFNhbHR5IGZyb20gXCIuLi8uLi9jbGFzc2VzL1NhbHR5XCI7XG5cbmV4cG9ydCBkZWZhdWx0IG5ldyBDb21tYW5kKHtcbiAgICBuYW1lOiBcImNvbW1hbmRcIixcbiAgICBrZXlzOiBbXCJjbWRcIiwgXCJjb21tYW5kc1wiXSxcbiAgICBoZWxwOiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGFyZ3VtZW50OiBudWxsLFxuICAgICAgICAgICAgZWZmZWN0OiBudWxsLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBhcmd1bWVudDpcbiAgICAgICAgICAgICAgICBcIioqKmNvbW1hbmQga2V5IDEqKiosICoqKmNvbW1hbmQga2V5IDIqKiosIC4uLiAgXFxcXGBcXFxcYFxcXFxgKioqY29tbWFuZCBibG9jayoqKlxcXFxgXFxcXGBcXFxcYFwiLFxuICAgICAgICAgICAgZWZmZWN0OlxuICAgICAgICAgICAgICAgIFwiQ3JlYXRlcyBhIG5ldyBjb21tYW5kIGhhdmluZyAqKipjb21tYW5kIGtleXMqKiogYXMgaXRzIHRyaWdnZXJzLiAqKipjb21tYW5kIGVmZmVjdCoqKiB3aWxsIHRoZW4gYmUgZGlzcGxheWVkIGFzIGEgcmVzcG9uc2VcIixcbiAgICAgICAgfSxcbiAgICBdLFxuICAgIHZpc2liaWxpdHk6IFwiZGV2XCIsXG4gICAgYXN5bmMgYWN0aW9uKG1zZywgYXJncykge1xuICAgICAgICBzd2l0Y2ggKHRoaXMubWVhbmluZyhhcmdzWzBdKSkge1xuICAgICAgICAgICAgY2FzZSBcImRlbGV0ZVwiOlxuICAgICAgICAgICAgICAgIGNvbnN0IGNvbW1hbmROYW1lOiBzdHJpbmcgPSBhcmdzWzFdO1xuICAgICAgICAgICAgICAgIGlmICghY29tbWFuZE5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1pc3NpbmdBcmcoXCJjb21tYW5kXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb25zdCBjb21tYW5kOiBRdWlja0NvbW1hbmQgPSBRdWlja0NvbW1hbmQuZmluZChcbiAgICAgICAgICAgICAgICAgICAgKGNtZDogUXVpY2tDb21tYW5kKTogYm9vbGVhbiA9PlxuICAgICAgICAgICAgICAgICAgICAgICAgY21kLmtleXMuaW5jbHVkZXMoY29tbWFuZE5hbWUpXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICBpZiAoIWNvbW1hbmQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFNhbHR5RXhjZXB0aW9uKFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJOb25FeGlzdGluZ09iamVjdFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJUaGF0IGNvbW1hbmQgZG9lc24ndCBleGlzdFwiXG4gICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIFNhbHR5LnVuc2V0UXVpY2tDb21tYW5kKGNvbW1hbmQpO1xuICAgICAgICAgICAgICAgIGF3YWl0IFF1aWNrQ29tbWFuZC5yZW1vdmUoY29tbWFuZC5pZCk7XG5cbiAgICAgICAgICAgICAgICBTYWx0eS5zdWNjZXNzKG1zZywgYENvbW1hbmQgXCIqKiR7Y29tbWFuZC5uYW1lfSoqXCIgZGVsZXRlZGApO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcImxpc3RcIjpcbiAgICAgICAgICAgIGNhc2UgXCJub2FyZ1wiOlxuICAgICAgICAgICAgICAgIGlmICghUXVpY2tDb21tYW5kLnNpemUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVtcHR5T2JqZWN0KFwiY29tbWFuZHNcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGF3YWl0IFNhbHR5LmVtYmVkKG1zZywge1xuICAgICAgICAgICAgICAgICAgICB0aXRsZTogXCJMaXN0IG9mIGNvbW1hbmRzXCIsXG4gICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBRdWlja0NvbW1hbmQubWFwKFxuICAgICAgICAgICAgICAgICAgICAgICAgKGNtZCwgaSkgPT4gYCR7aSArIDF9KSAke2NtZC5uYW1lfWBcbiAgICAgICAgICAgICAgICAgICAgKS5qb2luKFwiXFxuXCIpLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICBjb25zdCBhbGxBcmdzID0gYXJncy5qb2luKFwiIFwiKS5zcGxpdChcImBgYFwiKTtcblxuICAgICAgICAgICAgICAgIGlmICghYWxsQXJnc1sxXSkge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWlzc2luZ0FyZyhcImVmZmVjdFwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgbGV0IGtleXM6IHN0cmluZ1tdID0gYWxsQXJnc1xuICAgICAgICAgICAgICAgICAgICAuc2hpZnQoKVxuICAgICAgICAgICAgICAgICAgICAuc3BsaXQoXCIsXCIpXG4gICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoKHdvcmQpID0+IHdvcmQudHJpbSgpICE9PSBcIlwiKTtcbiAgICAgICAgICAgICAgICBjb25zdCBuYW1lOiBzdHJpbmcgPSBrZXlzWzBdO1xuICAgICAgICAgICAgICAgIGNvbnN0IGVmZmVjdDogc3RyaW5nID0gYWxsQXJncy5zaGlmdCgpLnRyaW0oKTtcblxuICAgICAgICAgICAgICAgIGlmICgha2V5c1swXSkge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWlzc2luZ0FyZyhcImtleXNcIik7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZm9yIChsZXQga2V5ID0gMDsga2V5IDwga2V5cy5sZW5ndGg7IGtleSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGtleXNba2V5XSA9IGtleXNba2V5XS50cmltKCkudG9Mb3dlckNhc2UoKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoU2FsdHkuY29tbWFuZHMua2V5c1trZXlzW2tleV1dKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgU2FsdHlFeGNlcHRpb24oXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJFeGlzdGluZ09iamVjdFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiVGhhdCBjb21tYW5kIGFscmVhZHkgZXhpc3RzXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBjb25zdCBjb21tYW5kczogUXVpY2tDb21tYW5kW10gPSBhd2FpdCBRdWlja0NvbW1hbmQuY3JlYXRlKHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgICAgICAgICAga2V5czoga2V5cy5qb2luKCksXG4gICAgICAgICAgICAgICAgICAgIGVmZmVjdCxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBTYWx0eS5zZXRRdWlja0NvbW1hbmQoY29tbWFuZHNbMF0pO1xuXG4gICAgICAgICAgICAgICAgYXdhaXQgU2FsdHkuc3VjY2Vzcyhtc2csIGBDb21tYW5kIFwiKioke25hbWV9KipcIiBjcmVhdGVkYCk7XG4gICAgICAgIH1cbiAgICB9LFxufSk7XG4iXX0=